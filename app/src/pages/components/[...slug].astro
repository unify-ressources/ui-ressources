---
export const prerender = true;

import { splitSlugUrl } from "@helper/string-helper";
import { getCollection } from "astro:content";
import DocLayout from "@layouts/DocsLayout.astro";
import { getPagger } from "@assets/js/pager";
import LinkNavControl from "@components/docs/ui/LinkNavControl.astro";
import { components } from "@components/docs/MdxComponents.astro";
import UiLink from "@components/atoms/UiLink.astro";
import { contribUrl, repoContentLocation } from "@/const/index";
import DocPageHeader from "@components/docs/DocPageHeader.astro";
import BoxTableOfContent from "@components/docs/ui/BoxTableOfContent.astro";
import DefaultModal from "@components/registry/alert-dialog/modals/DefaultModal.astro";

export async function getStaticPaths() {
  const componentDocs = await getCollection("components");
  return componentDocs.map((doc) => ({
    params: { slug: doc.slug },
    props: { doc_content: doc },
  }));
}

const { doc_content } = Astro.props;

const {
  slug,
  data: { title, description, links, hideTableOfContent },
  id,
} = doc_content;

const { Content, headings } = await doc_content.render();

const {
  next: nextSlug,
  prev: prevSlug,
  current,
} = getPagger({ slug: slug, name: "components", baseUrl: "components" });

const words = splitSlugUrl(slug);
---

<DocLayout
  activeGroup="components"
  activeItem={`/components/${slug}`}
  headings={headings}
  title={`${current.title}`}
  description={`${current.description}`}
  keywords={current.keywords}
  hideTableOfContent={hideTableOfContent}
>
  <article
    data-pagefind-body
    class="px4 sm-px8 xl-px16 grid text-body hmax"
  >
    <DocPageHeader
      title={title}
      subTitle={description}
      links={links}
      breadcrumbsMain={{ href: "/components", text: "Components" }}
      breadcrumbsWords={words}
    />
    <div data-doc-content class="py10 wfull grid">
      <Content components={{ ...components }} />
    </div>
    <div>
      <UiLink
        href={`${repoContentLocation}/components/${id}`}
        aria-label="edit this page on github"
        class="wmax flex items-center gap-x-2 underline underline-dashed underline-offset-3 hover-text-title"
      >
        <span aria-hidden="true" class="flex i-ph-pencil-simple-line"></span>
        Edit this page
      </UiLink>
    </div>

    <div class="flex wfull hpx my8 b-b bdr_b-nm"></div>
    <div
      data-pagefind-ignore
      class="flex flex-col sm-flex-row w-full justify-between gap-4"
    >
      <div class="flex-1">
        {
          prevSlug ? (
            <LinkNavControl
              text={prevSlug.title}
              href={prevSlug.slug}
              type="prev"
            />
          ) : null
        }
      </div>

      <div class="flex-1">
        {
          nextSlug ? (
            <LinkNavControl
              text={nextSlug.title}
              href={nextSlug.slug}
              type="next"
            />
          ) : null
        }
      </div>
    </div>
  </article>
  {
    !hideTableOfContent ? (
      <BoxTableOfContent
        headings={headings}
        fileName={`/components/${id}`}
        contribUrl={contribUrl}
      />
    ) : null
  }
  {
    id === "alert-dialog.mdx" ? (
      <div slot="modalZone" class="z100 fixed">
        <DefaultModal />
      </div>
    ) : null
  }
</DocLayout>
